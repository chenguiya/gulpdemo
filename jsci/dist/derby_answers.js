define(function(s,e,n){var t=s("jquery");t.fn.derbyanswer=function(s){function e(){var s=[],e=!1;for(i=0;i<y.length;i++)e=y[i]==k[i]?!0:!1,s.push(e);return s}function n(s){return s>=80?f.resultComment.ninety:s>=70?f.resultComment.eighty:s>=60?f.resultComment.seventy:s>=50?f.resultComment.sixty:s>=40?f.resultComment.fifty:s>=30?f.resultComment.forty:s>=20?f.resultComment.thirty:f.resultComment.twenty}function a(){for(var s=e(),i="",a=0,o=0;o<s.length;o++)s[o]===!0&&(a++,isCorrect=!0);t.ajax({type:"GET",url:cid_url+"/api/debi/usermark",data:{team:f.jsons.team,score:a,uid:f.jsons.uid},dataType:"json",success:function(s){i+="<span>恭喜"+f.jsons.username+"！您答对"+a+"道题，获得"+a+"分，超过"+n(a)+"的"+d+"球迷！分享出去获得更多的答题机会！^_^</span>",_.find(".tion_container").fadeOut(100,function(){_.find(".result_container").show(),_.find(".results_ok").html(i)})},error:function(){showmsg("数据有误")}})}function o(){C-=1,0>C?(window.clearInterval(u),_.find(".tion_answers").each(function(s){t(this).find("li.selected").each(function(s){k.push(t(this).parents(".tion_answers").children("li").index(t(this).parents(".tion_answers").find("li.selected"))+1)}),t(this).find("li").hasClass("selected")||k.push(5)}),a()):_.find(".J_counter").text(C+"'")}var d,r,c,l,u,p={jsons:null,endText:"已经结束",shortURL:null,sendResultsURL:null,resultComment:{ninety:"90%",eighty:"80%",seventy:"70%",sixty:"60%",fifty:"50%",forty:"40%",thirty:"30%",twenty:"20%"}},f=t.extend(p,s),m=-1!=navigator.userAgent.toLowerCase().indexOf("micromessenger"),_=t(this),h=0,y=[],v=(cid_url+"/static/images/derby/derby_logo.jpg",cid_url+"/static/images/derby/derby_code.jpg"),b=cid_url+"/static/images/derby/download_wxl.png",w=(cid_url+"/api/debi",'<div class="resul_time_cotainer df"><span class="J_counter">60\'</span><span class="tion-number"><em>'+h+"</em></span></div>"),j='<div class="result_container"> 	              <div class="tion_title">答题结束<span></span><a id="icon_closeid" class="icon-nots" href="javascript:void(0);"></a></div> 	              <div class="tion_area"> 	                   <div class="tion_question"> 	                        <span class="results_title">答题结束</span> 	                        <div class="results_avatar flex_center"><img src="'+f.jsons.avatar+'"></div> 	                        <div class="results_ok"></div> 	                        <div class="results_btn"> 	                             <a href="javascript:void(0);" class="results_share_btn">分享</a> 	                        </div> 	                   </div> 	                   <div class="tion_answers flex_center"><img src="'+v+'"></div> 	              </div> 	         </div>',g='<div class="weiXin_pop" id="weiXin_pop"><img src="'+b+'"></div>',x="",C=60;for(r=0;r<f.jsons.questions.length;r++){for(x+='<div class="tion_container">',x+='<div class="tion_title">第'+(r+1)+"题<span></span></div>",x+='<div class="tion_area">',x+='<div class="tion_question">'+f.jsons.questions[r].question,f.jsons.questions[r].attach.length&&(x+='<span><img src="'+f.jsons.questions[r].attach+'"></span>'),x+="</div>",x+='<ol type="A" class="tion_answers" data-types="'+f.jsons.questions[r].answer+'">',c=0;c<f.jsons.questions[r].option.length;c++)x+="<li>"+f.jsons.questions[r].option[c]+"</li>";x+="</ol></div>",x+="</div>",y.push(f.jsons.questions[r].answer)}_.html(x+j+w+g),1==f.jsons.team?(document.body.style.background="#e93e47",_.addClass("redStyle"),d="恒大"):2==f.jsons.team?(document.body.style.background="#2b56a3",_.addClass("blueStyle"),d="富力"):3==f.jsons.team?(document.body.style.background="#004899",_.addClass("basaStyle"),d="巴萨"):4==f.jsons.team&&(document.body.style.background="#f6c52d",_.addClass("huangmaStyle"),d="皇马"),_.find(".resul_time_cotainer").css({display:"block"}),u=window.setInterval(function(){o()},1e3);var k=[],q=(f.jsons.questions.length,_.find(".tion_container"));q.hide().first().fadeIn(500),_.find("li").click(function(){var s=t(this),e=s.parent().attr("data-types"),n=s.index()+1;n==e?(s.parents(".tion_answers").children("li").removeClass("selected"),s.addClass("selected"),h++,_.find(".tion-number em").text(h)):s.addClass("no_selected"),s.parents(".tion_container").fadeOut(500,function(){t(this).next().fadeIn(500)})}),_.find(".results_share_btn").click(function(){if(m)l=3==f.jsons.team||4==f.jsons.team?1:0,t.ajax({type:"GET",url:cid_url+"/api/debi/weixinshare",data:{uid:f.jsons.uid,type:"reg_lottery",typeid:l},dataType:"json",success:function(s){_.find("#weiXin_pop").fadeIn(200)},error:function(){showmsg("数据有误")}});else{if(3==f.jsons.team||4==f.jsons.tema)var s=cid_url+"/static/images/derby/xibanya_share.jpg";else var s=cid_url+"/static/images/derby/share_20160330.jpg";var e=shellmodule.Base64Encode(s);shellmodule.ShareLottery(e)}}),_.find("#weiXin_pop img").click(function(){_.find("#weiXin_pop").fadeOut(200)}),3==f.jsons.team||4==f.jsons.team?_.find("#icon_closeid").click(function(){m?window.location.href="http://wx.5usport.com/index.php/Access?oid=&fid=1&type=&stype=10001&backurl=http%3A%2F%2Fcid.5usport.com%2Fapi%2Fdebi%2Findex%3Fderbyid%3D2":window.location.href=cid_url+"/api/debi/index?derbyid=2"}):_.find("#icon_closeid").click(function(){m?window.location.href="http://wx.5usport.com/index.php/Access?oid=&fid=1&type=&stype=10001&backurl=http%3A%2F%2Fcid.5usport.com%2Fapi%2Fdebi%2Findex":window.location.href=cid_url+"/api/debi"})}});