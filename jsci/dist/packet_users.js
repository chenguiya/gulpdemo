define(function(e,t,n){var o=e("jquery");o.fn.packetset=function(e){function t(e,t,n,a,i,l){var d=new Date(e).getTime(),s=new Date(t).getTime(),r=(d-s)/1e3,u=setInterval(function(){if(r>0){r-=1;var e=Math.floor(r/3600/24),t=Math.floor(r/3600%24),d=Math.floor(r/60%60),s=Math.floor(r%60);n&&o(n).text(e),c.find(a).text(10>t?"0"+t:t),c.find(i).text(10>d?"0"+d:d),c.find(l).text(10>s?"0"+s:s)}else clearInterval(u),window.location.reload(),console.log(u)},1e3)}function n(){u.globalCompositeOperation="source-over",u.fillStyle="#f8b62d",u.fillRect(0,0,r.clientWidth,r.clientHeight),u.fill(),u.drawImage(imageIMG,0,0),u.font="Bold 40px Microsoft YaHei",u.textAlign="center",u.fillStyle="#ed6819",u.fillText("刮一刮",r.width/2,50),u.globalCompositeOperation="destination-out"}function a(e){e.preventDefault(),f=!0}function i(e){e.preventDefault();for(var t=u.getImageData(0,0,r.width,r.height),n=0,a=3;a<t.data.length;a+=4)0==t.data[a]&&n++;n>=t.data.length/8&&(g=1,o.ajax({type:"GET",url:cid_url+"/api/packet_share/join_act",data:{uid:s.shareUid},dataType:"json",success:function(e){c.find("#ggcanvas").append('<div id="dice_mask"></div>'),console.log(e.message)},error:function(){showmsg("数据有问题")}})),f=!1}function l(e){if(e.preventDefault(),f){e.changedTouches&&(e=e.changedTouches[e.changedTouches.length-1]);var t=document.getElementById("ggcanvas").offsetTop,n=r.offsetLeft,o=r.offsetTop+t,a=(e.clientX+document.body.scrollLeft||e.pageX)-n||0,i=(e.clientY+document.body.scrollTop||e.pageY)-o||0;u.beginPath(),u.arc(a,i,1.2*m,0,2*Math.PI,!0),r.style.display="none",r.offsetHeight,r.style.display="inherit",u.fill()}}var d={json:null,starttime:null,shareURL:null,endtime:null,shareUid:null,canvasMove:null},s=o.extend(d,e),c=(-1!=navigator.userAgent.toLowerCase().indexOf("micromessenger"),o(this));if(c.find("#packetShare").click(function(){o.ajax({type:"GET",url:cid_url+"/api/packet_share/check",dataType:"json",success:function(e){401===e.code?shellmodule.login(e.message):402===e.code?showmsg(e.message,"",1e3):403===e.code?showmsg(e.message,"",1e3):shellmodule.ShareModule("","",s.shareURL,"","al_redpacket")},error:function(){showmsg("数据有误")}})}),null!==s.endtime&&null!==s.starttime&&t(s.endtime,s.starttime,null,"#znq_countdown .hours","#znq_countdown .minute","#znq_countdown .second"),null!==s.canvasMove&&null!==s.shareUid){var r,u,f,h=function(){function e(e,t){return Math.floor(Math.random()*(t-e))+e}e(1,100);g=0},g=0,m=parseInt(window.getComputedStyle(document.documentElement,null)["font-size"]);document.getElementById("imageIMG");h(),r=document.getElementById("c1"),r.width=r.clientWidth,r.height=r.clientHeight,u=r.getContext("2d"),r.addEventListener("mousemove",l,!1),r.addEventListener("mousedown",a,!1),r.addEventListener("mouseup",i,!1),r.addEventListener("touchstart",a,!1),r.addEventListener("touchend",i,!1),r.addEventListener("touchmove",l,!1),n()}}});