define("test/task",["jquery","poshytip","common","datePicker"],function(a,s,t){"user strict";var e=a("jquery"),i=a("common"),n={};n.tooltip=a("poshytip"),n.Datepick=a("datePicker"),n.init=function(){var a=e("#taskList");a.on({click:function(a){var s=e(this).closest("li"),t=s.children("ul");if(t.length>0){var a=s.children(".singleTreeTask");a.find(".TaskAdd").removeClass("on").addClass("off").end(),t.slideDown()}}},".TaskAdd.on"),a.on({click:function(a){var s=e(this).closest("li"),t=s.children(".singleTreeTask");t.find(".TaskAdd").removeClass("off").addClass("on"),s.children("ul").slideUp(function(){s.children("ul").find("li").is(".addSubTask")&&s.children("ul").find("li.addSubTask").remove()})}},".TaskAdd.off"),a.on({click:function(){var a=e(this).closest("li"),s=parseInt(e(this).attr("data-taskid"));e.ajax({type:"GET",url:homeUrl+"admin/task/delete",data:{taskid:s},dataType:"json",success:function(s){200==s.code&&(a.parent(".singleSubTask").find("li").length<=1&&(a.parent(".singleSubTask").prev().find(".TaskAdd").removeClass("off"),a.parents(".singleSubTask").remove()),a.remove(),i.showmsg("删除任务成功"))},error:function(){alert("数据有问题")}})}},".task_signalDetele"),a.on({keyup:function(a){var s=e(this),t=parseInt(s.attr("titleid")),n=s.val();13==a.keyCode&&e.ajax({type:"GET",url:homeUrl+"admin/task/edit",data:{taskid:t,title:n},dataType:"json",success:function(a){i.showmsg("修改成功","",1e3)},error:function(){alert("数据有问题")}})}},".subTaskName"),a.on({keyup:function(a){var s=e(this);13==a.keyCode&&e.ajax({type:"POST",url:homeUrl+"admin/task/addnew",data:{parentid:0,title:s.val()},dataType:"json",success:function(a){s.val("");var t='<li class="">';t+='<div class="singleTreeTask" style="padding-left:0px;">',t+='<span class="TaskAdd"></span>',t+='<span class="defaultListColorTask whiteTask"></span>',t+='<span class="treeMark">',t+='<span class="markTask" data-id="'+a.data.taskid+'" data-val="1" title="标记完成"></span>',t+="</span>",t+='<div class="taskListName">',t+='<input class="subTaskName" titleid="'+a.data.taskid+'" data-title="'+a.data.name+'" maxlength="256" value="'+a.data.name+'">',t+="</div>",t+='<div class="operation">',t+='<span class="taskListDate"  name="starttimefrom_'+a.data.taskid+'" id="starttimefrom_'+a.data.taskid+'" data-id="'+a.data.taskid+'"><span data-date="null" class="deteLine">设置到期时间</span></span>',t+='<i class="icon-task-signal" data-parentid="'+a.data.taskid+'" tip="子任务">子任务</i>',t+='<span class="task_signalDetele" data-taskid="'+a.data.taskid+'" title="删除"></span>',t+="</div>",t+="</div>",t+="</li>",e("#taskList ul").is(".singleTask")&&(e("#taskList ul").prepend(t),s.parents(".createNewTask").remove())},error:function(){alert("数据有问题")}})}},".txtSingleName"),e("#diskMain").on({click:n.createTaskBig},".add_taskad"),a.on({click:function(){var a=e(this),s=a.attr("data-parentid"),t=a.closest("li").children("ul");t.length>0?(t.is(":hidden")&&(t.prev().find(".TaskAdd").removeClass("on").addClass("off").end(),t.slideDown()),n.createTasksmall(a,s)):(a.closest("li").append('<ul class="singleSubTask"></ul>'),n.createTasksmall(a,s))}},".icon-task-signal"),a.on({keyup:function(a){var s=e(this),t=parseInt(s.attr("data-id"));13==a.keyCode&&e.ajax({type:"POST",url:homeUrl+"admin/task/addnew",data:{parentid:t,title:s.val()},dataType:"json",success:function(a){s.val();var t="";t+='<li class="tLine">',t+='<div class="tliLine" style="left:20px;"></div>',t+='<div class="singleTreeTask">',t+='<span class="subJoinLine"></span>',t+='<span class="InlineBlockTop subNoneNode"></span>',t+='<span class="nodeCircleSmall circle "></span>',t+='<span class="defaultListColorTask whiteTask"></span>',t+='<span class="treeMark"><span class="markTask" title="标记完成"></span></span>',t+='<div class="taskListName">',t+='<input class="subTaskName" maxlength="256" value="'+a.data.name+'">',t+="</div>",t+='<div class="operation">',t+='<span class="taskListDate" name="starttimefrom_'+a.data.taskid+'" id="starttimefrom_'+a.data.taskid+'" data-id="'+a.data.taskid+'"><span data-date="null" class="deteLine">设置到期时间</span></span>',t+='<i class="task_None" tip="子任务"></i>',t+='<span class="task_signalDetele" data-id="" title="删除"></span>',t+="</div>",t+="</div>",t+="</li>",s.closest(".addSubTask").parent(".singleSubTask").prepend(t),s.parents(".singleSubTask").prev().find(".TaskAdd").addClass("off"),s.parents(".addSubTask").remove(),i.showmsg("添加子任务成功","",1500)},error:function(){i.showmsg("数据有问题","",1e3)}})}},".addsubTaskName"),a.on({click:function(a){var s=e(this),t=parseInt(s.attr("data-val")),i=parseInt(s.attr("data-id"));return e.ajax({type:"GET",url:homeUrl+"admin/task/change_status",data:{taskid:i,status:t},dataType:"json",success:function(a){var t;s.hasClass("completeHook")?(s.removeClass("completeHook"),s.parent().next(".taskListName").find(".subTaskName").removeClass("over_ellipsis"),t="标记完成",s.attr("data-val",1)):(s.addClass("completeHook"),s.parent().next(".taskListName").find(".subTaskName").addClass("over_ellipsis"),t="标记为未完成",s.attr("data-val",0)),s.poshytip({content:t,className:"tip-twitter",showTimeout:1,alignTo:"target",alignX:"center",alignY:"bottom",offsetY:5,allowTipHover:!1,fade:!1,slide:!1})},error:function(){alert("数据有问题")}}),!1}},".markTask"),a.on({click:function(){var a=(e(this).attr("id"),e(this),parseInt(e(this).attr("data-id")));WdatePicker({dateFmt:"yyyy-MM-dd",onpicked:function(s){e.ajax({type:"GET",url:homeUrl+"admin/task/set_expiration",data:{taskid:a,expiration:s.cal.getDateStr()},dataType:"json",success:function(a){200==a.code?i.showmess(a.message,"",1e3):i.showmess(a.message,"",1e3)},error:function(){alert("数据有问题")}})}})}},".taskListDate"),e("#taskList .markTask").poshytip({className:"tip-twitter",showTimeout:1,alignTo:"target",alignX:"center",alignY:"bottom",offsetY:5,allowTipHover:!1,fade:!1,slide:!1})},n.createTaskBig=function(a){var s="";return s+='<div class="createNewTask">',s+='<div class="createNewSingle ThemeBGColor5">',s+='<span class="markTask"></span>',s+='<input type="text" class="txtSingleName" maxlength="256" placeholder="输入名称后按回车创建">',s+="</div>",s+="</div>",e("#taskList .txtSingleName").length>0||e("#taskList>div").prepend(s),!1},n.createTasksmall=function(a,s){var t="";return t='<li class="addSubTask">',t+='<div class="tliLine" style="left:20px;"></div>',t+='<div class="singleTreeTask">',t+='<span class="subJoinLine"></span>',t+='<span class="InlineBlockTop subNoneNode"></span>',t+='<span class="nodeCircleSmall circle "></span>',t+='<span class="defaultListColorTask whiteTask"></span>',t+='<span class="treeMark"><span class="markTask" title="标记完成"></span></span>',t+='<div class="taskListName">',t+='<input class="addsubTaskName" data-id="'+s+'" maxlength="256" placeholder="输入名称后按回车创建">',t+="</div>",t+='<div class="operation">',t+='<span class="taskListDate" name="starttimefrom_'+s+'" id="starttimefrom_'+s+'"><span data-date="null" class="deteLine">设置到期时间</span></span>',t+='<i class="task_None" tip="子任务"></i>',t+='<span class="task_signalDetele" title="删除"></span>',t+="</div>",t+="</div>",t+="</li>",e("#taskList .addsubTaskName").length>0||a.closest("li").children(".singleSubTask").prepend(t),!1},t.exports=n});