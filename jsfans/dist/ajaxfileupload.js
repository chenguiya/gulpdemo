define(function(require,exports,module){var $=require("jquery");jQuery.extend({createuploadiframe:function(e,t){var o="uploadiframe"+e,r='<iframe id="'+o+'" name="'+o+'"';return window.ActiveXObject&&("boolean"==typeof t?r+=' src="javascript:false"':"string"==typeof t&&(r+=' src="'+t+'"')),r+=" />",jQuery(r).css({position:"absolute",top:"-1200px",left:"-1200px"}).appendTo(document.body),jQuery("#"+o).get(0)},createuploadform:function(e,t,o){var r="uploadform"+e,a="uploadfile"+e,n=jQuery('<form method="post" name="'+r+'" id="'+r+'" enctype="multipart/form-data"></form>');if(o)for(var u in o)jQuery('<input type="hidden" name="'+u+'" value="'+o[u]+'" />').appendTo(n);var i=jQuery("#"+t),s=jQuery(i).clone();return jQuery(i).attr("id",a).before(s).appendTo(n),jQuery(n).css({position:"absolute",top:"-1200px",left:"-1200px"}).appendTo(document.body),n},handleerror:function(e,t,o,r){e.error&&e.error.call(e.context||e,t,o,r),e.global&&(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,r])},ajaxfileupload:function(s){s=jQuery.extend({},jQuery.ajaxSettings,s);var id=(new Date).getTime(),form=this.createuploadform(id,s.fileElementId,"undefined"==typeof s.data?!1:s.data),io=this.createuploadiframe(id,s.secureuri),iframeid="uploadiframe"+id,formid="uploadform"+id;s.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var requestDone=!1,xml={};s.global&&jQuery.event.trigger("ajaxSend",[xml,s]);var uploadcallback=function(istimeout){function uploadhttpdata(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data),data}var io=document.getElementById(iframeid);try{io.contentWindow?(xml.responseText=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null,xml.responseXML=io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document):io.contentDocument&&(xml.responseText=io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null,xml.responseXML=io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document)}catch(e){this.handleerror(s,xml,null,e)}if(xml||"timeout"==istimeout){requestdone=!0;var status;try{if(status="timeout"!=istimeout?"success":"error","error"!=status){var data=uploadhttpdata(xml,s.dataType);s.success&&s.success(data,status),s.global&&jQuery.event.trigger("ajaxSuccess",[xml,s])}else this.handleerror(s,xml,status)}catch(e){status="error",this.handleerror(s,xml,status,e)}s.global&&jQuery.event.trigger("ajaxComplete",[xml,s]),s.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),s.complete&&s.complete(xml,status),jQuery(io).off(),setTimeout(function(){try{jQuery(io).remove(),jQuery(form).remove()}catch(e){this.handleerror(s,xml,null,e)}},100),xml=null}};s.timeout>0&&setTimeout(function(){requestdone||uploadcallback("timeout")},s.timeout);try{var form=jQuery("#"+formid);jQuery(form).attr("action",s.url).attr("method","post").attr("target",iframeid),form.encoding?jQuery(form).attr("encoding","multipart/form-data"):jQuery(form).attr("enctype","multipart/form-data"),jQuery(form).submit()}catch(e){this.handleerror(s,xml,null,e)}return jQuery("#"+iframeid).load(uploadcallback),{abort:function(){}}}})});