define("js/message",["jquery","js/module/emotion/emotion","common"],function(a,e,t){"user strict";var s=a("jquery"),n=a("common"),i={};i.emotion=a("js/module/emotion/emotion"),i.init=function(){var a=s("#actMessage");a.on({click:function(e){var t=s(this),i=t.closest("li").children(".actSublist"),o=t.attr("data-tid"),c=t.attr("data-pid"),r='<div class="comment_form">                          <textarea class="inputText" id="saytext_'+c+'" name="saytext"></textarea>                          <p><input type="button" class="faces_btn" value="提交"><span class="icon-emotion"> 可输入140字</span></p>                          </div>';return i.length>0?i.is(":hidden")?(i.prepend(r),i.slideDown(function(){a.find(".icon-emotion").qqFace({id:"facebox",assign:"saytext_"+c,path:homeUrl+"static/face/"}),a.find(".faces_btn").click(function(){var a=s("#saytext_"+c).val();""==a?n.showmsg("留言不能为空"):s.ajax({type:"POST",url:homeUrl+"admin/post",data:{action:"reply",tid:o,parentid:c,postsubmit:1,message:a},dataType:"json",success:function(a){var e='<li>                                                <span class="actreply"><em>'+a.data.author+"的回复：</em>"+a.data.message+'</span>                                                <span class="actime art">'+a.data.publishdate+'</span>                                                <span class="actoperation"><a href="javascript:;">删除</a></span>                                                </li>';n.showmsg(a.message,"",1e3),s("#saytext_"+c).val(""),s("#saytext_"+c).parent(".comment_form").next().prepend(e)},error:function(){n.showmsg("数据有问题","",1e3)}})})})):i.slideUp(function(){i.find(".comment_form").remove()}):(t.closest("li").append('<div class="actSublist"></div>'),t.closest("li").find(".actSublist").prepend(r),t.closest("li").find(".actSublist").slideDown(function(){a.find(".icon-emotion").qqFace({id:"facebox",assign:"saytext_"+c,path:homeUrl+"static/face/"}),a.find(".faces_btn").click(function(){var a=s("#saytext_"+c).val();""==a?n.showmsg("留言不能为空"):s.ajax({type:"POST",url:homeUrl+"admin/post",data:{action:"reply",tid:o,parentid:c,postsubmit:1,message:a},dataType:"json",success:function(a){var e='<li>                                                <span class="actreply"><em>'+a.data.author+"的回复：</em>"+a.data.message+'</span>                                                <span class="actime art">'+a.data.publishdate+'</span>                                                <span class="actoperation"><a href="javascript:;">删除</a></span>                                                </li>';n.showmsg(a.message,"",1e3),s("#saytext_"+c).val(""),s("#saytext_"+c).parent(".comment_form").next().prepend(e)},error:function(){n.showmsg("数据有问题","",1e3)}})})})),!1}},".messReply"),a.on({click:function(a){var e=parseInt(s(this).attr("data-pid")),t=s(this);s.ajax({type:"GET",url:homeUrl+"admin/post",data:{action:"delete",pid:e},dataType:"json",success:function(a){t.closest("li").remove(),n.showmsg("删除成功","",1e3)},error:function(){n.showmsg("数据有问题","",1e3)}})}},".deletePid")},i.replace_em=function(a){return a=a.replace(/\</g,"&lt;"),a=a.replace(/\>/g,"&gt;"),a=a.replace(/\n/g,"<br/>"),a=a.replace(/\[em_([0-9]*)\]/g,'<img src="/static/face/$1.gif" border="0" />')},t.exports=i});