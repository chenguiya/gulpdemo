define("test/message",["jquery","emotion","common"],function(e,a,t){"user strict";var s=e("jquery"),n=e("common"),i={};i.emotion=e("emotion"),i.init=function(){var e=s("#actMessage");e.on({click:function(a){var t=s(this),i=t.closest("li").children(".actSublist"),r=t.attr("data-tid"),o=t.attr("data-pid"),p='<div class="comment_form">';return p+='<textarea class="inputText" id="saytext_'+o+'" name="saytext"></textarea>',p+='<p><input type="button" class="faces_btn" value="提交"><span class="icon-emotion"> 可输入140字</span></p>',p+="</div>",i.length>0?i.is(":hidden")?(i.prepend(p),i.slideDown(function(){e.find(".icon-emotion").qqFace({id:"facebox",assign:"saytext_"+o,path:homeUrl+"static/face/"}),e.find(".faces_btn").click(function(){var e=s("#saytext_"+o).val();""==e?n.showmsg("留言不能为空"):s.ajax({type:"POST",url:homeUrl+"admin/post",data:{action:"reply",tid:r,parentid:o,postsubmit:1,message:e},dataType:"json",success:function(e){var a="<li>";a+='<span class="actreply"><em>'+e.data.author+"的回复：</em>"+e.data.message+"</span>",a+='<span class="actime art">'+e.data.publishdate+"</span>",a+='<span class="actoperation"><a href="javascript:;" data-pid="'+e.data.pid+'" class="deletePid">删除</a></span>',a+="</li>",n.showmsg(e.message,"",1e3),s("#saytext_"+o).val(""),s("#saytext_"+o).parent(".comment_form").next().prepend(a)},error:function(){n.showmsg("数据有问题","",1e3)}})})})):i.slideUp(function(){i.find(".comment_form").remove()}):(t.closest("li").append('<div class="actSublist"><ul></ul></div>'),t.closest("li").find(".actSublist").prepend(p),t.closest("li").find(".actSublist").slideDown(function(){e.find(".icon-emotion").qqFace({id:"facebox",assign:"saytext_"+o,path:homeUrl+"static/face/"}),e.find(".faces_btn").click(function(){var e=s("#saytext_"+o).val();""==e?n.showmsg("留言不能为空"):s.ajax({type:"POST",url:homeUrl+"admin/post",data:{action:"reply",tid:r,parentid:o,postsubmit:1,message:e},dataType:"json",success:function(e){var a="<li>";a+='<span class="actreply"><em>'+e.data.author+"的回复：</em>"+e.data.message+"</span>",a+='<span class="actime art">'+e.data.publishdate+"</span>",a+='<span class="actoperation"><a href="javascript:;">删除</a></span>',a+="</li>",n.showmsg(e.message,"",1e3),s("#saytext_"+o).val(""),s("#saytext_"+o).parent(".comment_form").next().prepend(a)},error:function(){n.showmsg("数据有问题","",1e3)}})})})),!1}},".messReply"),e.on({click:function(e){var a=parseInt(s(this).attr("data-pid")),t=s(this);s.ajax({type:"GET",url:homeUrl+"admin/post",data:{action:"delete",pid:a},dataType:"json",success:function(e){t.closest("li").remove(),n.showmsg("删除成功","",1e3)},error:function(){n.showmsg("数据有问题","",1e3)}})}},".deletePid");var a=s("#messageLists");a.on({click:function(){var e=window.location.href,a=s(this),t=parseInt(s(this).prev(".page_num").find(".first").text())+1,n=parseInt(s(this).prev(".page_num").find(".last").text());i.ajaxsubmit(a,e,t,n,"next")}},"#page_nextbtn"),a.on({click:function(){var e=window.location.href,a=s(this),t=parseInt(s(this).next(".page_num").find(".first").text())-1,n=parseInt(s(this).next(".page_num").find(".last").text());i.ajaxsubmit(a,e,t,n,"prev")}},"#page_prevbtn"),a.on({click:function(){var e=s(this),a=(e.parent(".goto_area").prev().find("#page_prevbtn"),e.parent(".goto_area").prev().find("#page_nextbtn"),e.prev().val()),t=parseInt(a),r=/^\d+$/,o=window.location.href,p=parseInt(s(this).parent(".goto_area").prev().find(".page_num .last").text());""==a||a>p||!r.test(a)?n.showmsg("请输入正确页码"):i.ajaxsubmit(e,o,t,p,"pagego")}},"#page_gobtn")},i.replace_em=function(e){return e=e.replace(/\</g,"&lt;"),e=e.replace(/\>/g,"&gt;"),e=e.replace(/\n/g,"<br/>"),e=e.replace(/\[em_([0-9]*)\]/g,'<img src="/static/face/$1.gif" border="0" />')},i.ajaxsubmit=function(e,a,t,i,r){s.ajax({type:"GET",url:a,data:{page:t},dataType:"html",success:function(a){var a=s(a).find("#messageLists #actMessage");if(s("#messageLists #actMessage").html(a),"next"==r)e.parent(".page_nav_area").find("#page_prevbtn").show(),e.prev(".page_num").find(".first").text(t),i==t&&e.hide();else if("prev"==r)e.parent(".page_nav_area").find("#page_nextbtn").show(),e.next(".page_num").find(".first").text(t),1==t&&e.hide();else if("pagego"==r){e.parent(".goto_area").prev(".page_nav_area").find(".first").text(t);var n=e.parent(".goto_area").prev().find("#page_prevbtn"),o=e.parent(".goto_area").prev().find("#page_nextbtn");i==t?(n.show(),o.hide()):1==t?(o.show(),n.hide()):(n.show(),o.show())}},error:function(){n.showmsg("数据有问题","",1e3)}})},t.exports=i});