define(function(t,e,a){function s(t,e){var a={aToday:"aToday",aYesterday:"aYesterday",aRecent7Days:"aRecent7Days",aRecent14Days:"aRecent14Days",aRecent30Days:"aRecent30Days",aRecent90Days:"aRecent90Days",startDate:"",endDate:"",startCompareDate:"",endCompareDate:"",minValidDate:"315507600",maxValidDate:"",success:function(t){return!0},startDateId:"startDate",startCompareDateId:"startCompareDate",endDateId:"endDate",endCompareDateId:"endCompareDate",target:"",needCompare:!1,suffix:"",inputTrigger:"input_trigger",compareTrigger:"compare_trigger",compareCheckboxId:"needCompare",calendars:2,dayRangeMax:0,monthRangeMax:12,dateTable:"dateRangeDateTable",selectCss:"dateRangeSelected",compareCss:"dateRangeCompare",coincideCss:"dateRangeCoincide",firstCss:"first",lastCss:"last",clickCss:"today",disableGray:"dateRangeGray",isToday:"dateRangeToday",joinLineId:"joinLine",isSingleDay:!1,defaultText:" 至 ",singleCompare:!1,stopToday:!0,isTodayValid:!1,weekendDis:!1,disCertainDay:[],disCertainDate:[],shortOpr:!1,noCalendar:!1,theme:"gri",magicSelect:!1,autoCommit:!1,autoSubmit:!1,replaceBtn:"btn_compare"},s=this;this.inputId=t,this.inputCompareId=t+"Compare",this.compareInputDiv="div_compare_"+t,this.mOpts=i.extend({},a,e),this.mOpts.calendars=Math.min(this.mOpts.calendars,3),this.mOpts.compareCss="ta"==this.mOpts.theme?this.mOpts.selectCss:this.mOpts.compareCss,this.periodObj={},this.periodObj[s.mOpts.aToday]=0,this.periodObj[s.mOpts.aYesterday]=1,this.periodObj[s.mOpts.aRecent7Days]=6,this.periodObj[s.mOpts.aRecent14Days]=13,this.periodObj[s.mOpts.aRecent30Days]=29,this.periodObj[s.mOpts.aRecent90Days]=89,this.startDefDate="";var d=""==this.mOpts.suffix?(new Date).getTime():this.mOpts.suffix;this.calendarId="calendar_"+d,this.dateListId="dateRangePicker_"+d,this.dateRangeCompareDiv="dateRangeCompareDiv_"+d,this.dateRangeDiv="dateRangeDiv_"+d,this.compareCheckBoxDiv="dateRangeCompareCheckBoxDiv_"+d,this.submitBtn="submit_"+d,this.closeBtn="closeBtn_"+d,this.preMonth="dateRangePreMonth_"+d,this.nextMonth="dateRangeNextMonth_"+d,this.startDateId=this.mOpts.startDateId+"_"+d,this.endDateId=this.mOpts.endDateId+"_"+d,this.compareCheckboxId=this.mOpts.compareCheckboxId+"_"+d,this.startCompareDateId=this.mOpts.startCompareDateId+"_"+d,this.endCompareDateId=this.mOpts.endCompareDateId+"_"+d;var r={gri:['<div id="'+this.calendarId+'" class="gri_dateRangeCalendar">','<table class="gri_dateRangePicker"><tr id="'+this.dateListId+'"></tr></table>','<div class="gri_dateRangeOptions" '+(this.mOpts.autoSubmit?' style="display:none" ':"")+">",'<div class="gri_dateRangeInput" id="'+this.dateRangeDiv+'" >','<input type="text" class="gri_dateRangeInput" name="'+this.startDateId+'" id="'+this.startDateId+'" value="'+this.mOpts.startDate+'" readonly />','<span id="'+this.mOpts.joinLineId+'"> - </span>','<input type="text" class="gri_dateRangeInput" name="'+this.endDateId+'" id="'+this.endDateId+'" value="'+this.mOpts.endDate+'" readonly /><br />',"</div>",'<div class="gri_dateRangeInput" id="'+this.dateRangeCompareDiv+'">','<input type="text" class="gri_dateRangeInput" name="'+this.startCompareDateId+'" id="'+this.startCompareDateId+'" value="'+this.mOpts.startCompareDate+'" readonly />','<span class="'+this.mOpts.joinLineId+'"> - </span>','<input type="text" class="gri_dateRangeInput" name="'+this.endCompareDateId+'" id="'+this.endCompareDateId+'" value="'+this.mOpts.endCompareDate+'" readonly />',"</div>","<div>",'<input type="button" name="'+this.submitBtn+'" id="'+this.submitBtn+'" value="确定" />','&nbsp;<a id="'+this.closeBtn+'" href="javascript:;">关闭</a>',"</div>","</div>","</div>"],ta:['<div id="'+this.calendarId+'" class="ta_calendar ta_calendar2 cf">','<div class="ta_calendar_cont cf" id="'+this.dateListId+'">',"</div>",'<div class="ta_calendar_footer cf" '+(this.mOpts.autoSubmit?' style="display:none" ':"")+">",'<div class="frm_msg">','<div id="'+this.dateRangeDiv+'">','<input type="text" class="ta_ipt_text_s" name="'+this.startDateId+'" id="'+this.startDateId+'" value="'+this.mOpts.startDate+'" readonly />','<span class="'+this.mOpts.joinLineId+'"> - </span>','<input type="text" class="ta_ipt_text_s" name="'+this.endDateId+'" id="'+this.endDateId+'" value="'+this.mOpts.endDate+'" readonly /><br />',"</div>",'<div id="'+this.dateRangeCompareDiv+'">','<input type="text" class="ta_ipt_text_s" name="'+this.startCompareDateId+'" id="'+this.startCompareDateId+'" value="'+this.mOpts.startCompareDate+'" readonly />','<span class="'+this.mOpts.joinLineId+'"> - </span>','<input type="text" class="ta_ipt_text_s" name="'+this.endCompareDateId+'" id="'+this.endCompareDateId+'" value="'+this.mOpts.endCompareDate+'" readonly />',"</div>","</div>",'<div class="frm_btn">','<input class="ta_btn ta_btn_primary" type="button" name="'+this.submitBtn+'" id="'+this.submitBtn+'" value="确定" />','<input class="ta_btn" type="button" id="'+this.closeBtn+'" value="取消"/>',"</div>","</div>","</div>"]},n={gri:['<label class="gri_contrast" for ="'+this.compareCheckboxId+'">','<input type="checkbox" class="gri_pc" name="'+this.compareCheckboxId+'" id="'+this.compareCheckboxId+'" value="1"/>对比',"</label>",'<input type="text" name="'+this.inputCompareId+'" id="'+this.inputCompareId+'" value="" class="gri_date"/>'],ta:['<label class="contrast" for ="'+this.compareCheckboxId+'">','<input type="checkbox" class="pc" name="'+this.compareCheckboxId+'" id="'+this.compareCheckboxId+'" value="1"/>对比',"</label>",'<div class="ta_date" id="'+this.compareInputDiv+'">','	<span name="dateCompare" id="'+this.inputCompareId+'" class="date_title"></span>','	<a class="opt_sel" id="'+this.mOpts.compareTrigger+'" href="#">','		<i class="i_orderd"></i>',"	</a>","</div>"]};"ta"==this.mOpts.theme?i(n[this.mOpts.theme].join("")).insertAfter(i("#div_"+this.inputId)):i(n[this.mOpts.theme].join("")).insertAfter(i("#"+this.inputId)),this.mOpts.noCalendar&&(i("#"+this.inputId).css("display","none"),i("#"+this.compareCheckboxId).parent().css("display","none")),i(0<i("#appendParent").length?"#appendParent":document.body).append(r[this.mOpts.theme].join("")),i("#"+this.calendarId).css("z-index",9999),1>i("#"+this.mOpts.startDateId).length?i(""!=this.mOpts.target?"#"+this.mOpts.target:"body").append('<input type="hidden" id="'+this.mOpts.startDateId+'" name="'+this.mOpts.startDateId+'" value="'+this.mOpts.startDate+'" />'):i("#"+this.mOpts.startDateId).val(this.mOpts.startDate),1>i("#"+this.mOpts.endDateId).length?i(""!=this.mOpts.target?"#"+this.mOpts.target:"body").append('<input type="hidden" id="'+this.mOpts.endDateId+'" name="'+this.mOpts.endDateId+'" value="'+this.mOpts.endDate+'" />'):i("#"+this.mOpts.endDateId).val(this.mOpts.endDate),1>i("#"+this.mOpts.compareCheckboxId).length&&i(""!=this.mOpts.target?"#"+this.mOpts.target:"body").append('<input type="checkbox" id="'+this.mOpts.compareCheckboxId+'" name="'+this.mOpts.compareCheckboxId+'" value="0" style="display:none;" />'),0==this.mOpts.needCompare?(i("#"+this.compareInputDiv).css("display","none"),i("#"+this.compareCheckBoxDiv).css("display","none"),i("#"+this.dateRangeCompareDiv).css("display","none"),i("#"+this.compareCheckboxId).attr("disabled",!0),i("#"+this.startCompareDateId).attr("disabled",!0),i("#"+this.endCompareDateId).attr("disabled",!0),i("#"+this.compareCheckboxId).parent().css("display","none"),i("#"+this.mOpts.replaceBtn).length>0&&i("#"+this.mOpts.replaceBtn).hide()):(1>i("#"+this.mOpts.startCompareDateId).length?i(""!=this.mOpts.target?"#"+this.mOpts.target:"body").append('<input type="hidden" id="'+this.mOpts.startCompareDateId+'" name="'+this.mOpts.startCompareDateId+'" value="'+this.mOpts.startCompareDate+'" />'):i("#"+this.mOpts.startCompareDateId).val(this.mOpts.startCompareDate),1>i("#"+this.mOpts.endCompareDateId).length?i(""!=this.mOpts.target?"#"+this.mOpts.target:"body").append('<input type="hidden" id="'+this.mOpts.endCompareDateId+'" name="'+this.mOpts.endCompareDateId+'" value="'+this.mOpts.endCompareDate+'" />'):i("#"+this.mOpts.endCompareDateId).val(this.mOpts.endCompareDate),""==this.mOpts.startCompareDate||""==this.mOpts.endCompareDate?(i("#"+this.compareCheckboxId).attr("checked",!1),i("#"+this.mOpts.compareCheckboxId).attr("checked",!1)):(i("#"+this.compareCheckboxId).attr("checked",!0),i("#"+this.mOpts.compareCheckboxId).attr("checked",!0))),this.dateInput=this.startDateId,this.changeInput(this.dateInput),i("#"+this.startDateId).bind("click",function(){return s.endCompareDateId==s.dateInput&&i("#"+s.startCompareDateId).val(s.startDefDate),s.startDefDate="",s.removeCSS(1),s.changeInput(s.startDateId),!1}),i("#"+this.calendarId).bind("click",function(t){t.stopPropagation()}),i("#"+this.startCompareDateId).bind("click",function(){return s.endDateId==s.dateInput&&i("#"+s.startDateId).val(s.startDefDate),s.startDefDate="",s.removeCSS(0),s.changeInput(s.startCompareDateId),!1}),i("#"+this.submitBtn).bind("click",function(){return s.close(1),s.mOpts.success({startDate:i("#"+s.mOpts.startDateId).val(),endDate:i("#"+s.mOpts.endDateId).val(),needCompare:i("#"+s.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+s.mOpts.startCompareDateId).val(),endCompareDate:i("#"+s.mOpts.endCompareDateId).val()}),!1}),i("#"+this.closeBtn).bind("click",function(){return s.close(),!1}),i("#"+this.inputId).bind("click",function(){return s.init(),s.show(!1,s),!1}),i("#"+this.mOpts.inputTrigger).bind("click",function(){return s.init(),s.show(!1,s),!1}),i("#"+this.mOpts.compareTrigger).bind("click",function(){return s.init(!0),s.show(!0,s),!1}),i("#"+this.inputCompareId).bind("click",function(){return s.init(!0),s.show(!0,s),!1}),this.mOpts.singleCompare&&("ta"===this.mOpts.theme?(i("#"+s.startDateId).val(s.mOpts.startDate),i("#"+s.endDateId).val(s.mOpts.startDate),i("#"+s.startCompareDateId).val(s.mOpts.startCompareDate),i("#"+s.endCompareDateId).val(s.mOpts.startCompareDate)):(i("#"+s.startDateId).val(s.mOpts.startDate),i("#"+s.endDateId).val(s.mOpts.startDate),i("#"+s.startCompareDateId).val(s.mOpts.startCompareDate),i("#"+s.endCompareDateId).val(s.mOpts.startCompareDate),i("#"+this.compareCheckboxId).attr("checked",!0),i("#"+this.mOpts.compareCheckboxId).attr("checked",!0))),i("#"+this.dateRangeCompareDiv).css("display",i("#"+this.compareCheckboxId).attr("checked")?"":"none"),i("#"+this.compareInputDiv).css("display",i("#"+this.compareCheckboxId).attr("checked")?"":"none"),i("#"+this.compareCheckboxId).bind("click",function(){i("#"+s.inputCompareId).css("display",this.checked?"":"none"),i("#"+s.dateRangeCompareDiv).css("display",this.checked?"":"none"),i("#"+s.compareInputDiv).css("display",this.checked?"":"none"),i("#"+s.startCompareDateId).css("disabled",this.checked?!1:!0),i("#"+s.endCompareDateId).css("disabled",this.checked?!1:!0),i("#"+s.mOpts.compareCheckboxId).attr("checked",i("#"+s.compareCheckboxId).attr("checked")),i("#"+s.mOpts.compareCheckboxId).val(i("#"+s.compareCheckboxId).attr("checked")?1:0),i("#"+s.compareCheckboxId).attr("checked")?(sDate=s.str2date(i("#"+s.startDateId).val()),sTime=sDate.getTime(),eDate=s.str2date(i("#"+s.endDateId).val()),eTime=eDate.getTime(),scDate=i("#"+s.startCompareDateId).val(),ecDate=i("#"+s.endCompareDateId).val(),(""==scDate||""==ecDate)&&(ecDate=s.str2date(s.date2ymd(sDate).join("-")),ecDate.setDate(ecDate.getDate()-1),scDate=s.str2date(s.date2ymd(sDate).join("-")),scDate.setDate(scDate.getDate()-(eTime-sTime)/864e5-1),ecDate.getTime()<1e3*s.mOpts.minValidDate&&(scDate=sDate,ecDate=eDate),ecDate.getTime()>=1e3*s.mOpts.minValidDate&&scDate.getTime()<1e3*s.mOpts.minValidDate&&(scDate.setTime(1e3*s.mOpts.minValidDate),scDate=s.str2date(s.date2ymd(scDate).join("-")),ecDate.setDate(scDate.getDate()+(eTime-sTime)/864e5-1)),i("#"+s.startCompareDateId).val(s.formatDate(s.date2ymd(scDate).join("-"))),i("#"+s.endCompareDateId).val(s.formatDate(s.date2ymd(ecDate).join("-")))),s.addCSS(1),s.changeInput(s.startCompareDateId)):(s.removeCSS(1),s.changeInput(s.startDateId)),s.close(1),s.mOpts.success({startDate:i("#"+s.mOpts.startDateId).val(),endDate:i("#"+s.mOpts.endDateId).val(),needCompare:i("#"+s.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+s.mOpts.startCompareDateId).val(),endCompareDate:i("#"+s.mOpts.endCompareDateId).val()})}),this.init(),this.close(1),this.mOpts.replaceBtn&&i("#"+this.mOpts.replaceBtn).length>0&&(i("#"+s.compareCheckboxId).hide(),i(".contrast").hide(),i("#"+this.mOpts.replaceBtn).bind("click",function(){var t=this;i("#"+s.compareCheckboxId).attr("checked")?i("#"+s.compareCheckboxId).removeAttr("checked"):i("#"+s.compareCheckboxId).attr("checked","checked"),i("#"+s.compareCheckboxId).click(),i("#"+s.compareCheckboxId).attr("checked")?function(){i("#"+s.compareCheckboxId).removeAttr("checked"),i(".contrast").hide(),i(t).text("按时间对比")}():function(){i("#"+s.compareCheckboxId).attr("checked","checked"),i(".contrast").show(),i(t).text("取消对比")}()})),this.mOpts.autoCommit&&this.mOpts.success({startDate:i("#"+s.mOpts.startDateId).val(),endDate:i("#"+s.mOpts.endDateId).val(),needCompare:i("#"+s.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+s.mOpts.startCompareDateId).val(),endCompareDate:i("#"+s.mOpts.endCompareDateId).val()}),i(document).bind("click",function(){s.close()})}var i=t("jquery");s.prototype.init=function(t){var e=this,a="undefined"!=typeof t?t&&i("#"+e.compareCheckboxId).attr("checked"):i("#"+e.compareCheckboxId).attr("checked");i("#"+this.dateListId).empty();var s=""==this.mOpts.endDate?new Date:this.str2date(this.mOpts.endDate);if(this.calendar_endDate=new Date(s.getFullYear(),s.getMonth()+1,0),this.mOpts.magicSelect&&"ta"==this.mOpts.theme){var d=0;do{var r=null;if(0==d)r=this.fillDate(this.str2date(i("#"+this.endDateId).val()).getFullYear(),this.str2date(i("#"+this.endDateId).val()).getMonth(),d),i("#"+this.dateListId).append(r);else{r=this.fillDate(this.str2date(i("#"+this.startDateId).val()).getFullYear(),this.str2date(i("#"+this.startDateId).val()).getMonth(),d);var n="ta"==this.mOpts.theme?i("#"+this.dateListId).find("table").get(0):i("#"+this.dateListId).find("td").get(0);i(n).before(r)}d++}while(2>d);this.calendar_startDate=new Date(this.str2date(i("#"+this.startDateId).val()).getFullYear(),this.str2date(i("#"+this.startDateId).val()).getMonth(),1)}else{for(var d=0;d<this.mOpts.calendars;d++){var r=null;if("ta"==this.mOpts.theme?r=this.fillDate(s.getFullYear(),s.getMonth(),d):(r=document.createElement("td"),i(r).append(this.fillDate(s.getFullYear(),s.getMonth(),d)),i(r).css("vertical-align","top")),0==d)i("#"+this.dateListId).append(r);else{var n="ta"==this.mOpts.theme?i("#"+this.dateListId).find("table").get(0):i("#"+this.dateListId).find("td").get(0);i(n).before(r)}s.setMonth(s.getMonth()-1,1)}this.calendar_startDate=new Date(s.getFullYear(),s.getMonth()+1,1)}i("#"+this.preMonth).bind("click",function(){return e.calendar_endDate.setMonth(e.calendar_endDate.getMonth()-1,1),e.mOpts.endDate=e.date2ymd(e.calendar_endDate).join("-"),e.init(t),1==e.mOpts.calendars&&(""==i("#"+e.startDateId).val()?e.changeInput(e.startDateId):e.changeInput(e.endDateId)),!1}),i("#"+this.nextMonth).bind("click",function(){return e.calendar_endDate.setMonth(e.calendar_endDate.getMonth()+1,1),e.mOpts.endDate=e.date2ymd(e.calendar_endDate).join("-"),e.init(t),1==e.mOpts.calendars&&(""==i("#"+e.startDateId).val()?e.changeInput(e.startDateId):e.changeInput(e.endDateId)),!1}),this.mOpts.magicSelect&&this.bindChangeForSelect(),this.endDateId!=this.dateInput&&this.endCompareDateId!=this.dateInput&&(a&&"undefined"!=typeof t?this.addCSS(1):this.addCSS(0)),a&&"undefined"!=typeof t?e.addCSS(1):e.addCSS(0),i("#"+e.inputCompareId).css("display",a?"":"none"),i("#"+this.compareInputDiv).css("display",i("#"+this.compareCheckboxId).attr("checked")?"":"none");for(var p in e.periodObj)i("#"+p).length>0&&(i("#"+p).unbind("click"),i("#"+p).bind("click",function(){var t="ta"==e.mOpts.theme?"active":"a";i(this).parent().nextAll().removeClass(t),i(this).parent().prevAll().removeClass(t),i(this).parent().addClass(t);var a=e.getSpecialPeriod(e.periodObj[i(this).attr("id")]);i("#"+e.startDateId).val(e.formatDate(a.otherday)),i("#"+e.endDateId).val(e.formatDate(a.today)),i("#"+e.mOpts.startDateId).val(i("#"+e.startDateId).val()),i("#"+e.mOpts.endDateId).val(i("#"+e.endDateId).val()),"ta"==e.mOpts.theme?i("#"+e.compareInputDiv).hide():i("#"+e.inputCompareId).css("display","none"),i("#"+e.compareCheckboxId).attr("checked",!1),i("#"+e.mOpts.compareCheckboxId).attr("checked",!1),i("#"+this.compareInputDiv).css("display",i("#"+this.compareCheckboxId).attr("checked")?"":"none"),e.close(1),i("#"+e.startCompareDateId).val(""),i("#"+e.endCompareDateId).val(""),i("#"+e.mOpts.startCompareDateId).val(""),i("#"+e.mOpts.endCompareDateId).val(""),i("#"+e.mOpts.compareCheckboxId).val(0),i("#"+e.mOpts.replaceBtn).length>0&&(i(".contrast").hide(),i("#"+e.mOpts.replaceBtn).text("按时间对比")),e.mOpts.success({startDate:i("#"+e.mOpts.startDateId).val(),endDate:i("#"+e.mOpts.endDateId).val(),needCompare:i("#"+e.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+e.mOpts.startCompareDateId).val(),endCompareDate:i("#"+e.mOpts.endCompareDateId).val()})}));i(document).bind("click",function(){e.close()}),i("#"+this.inputId).bind("change",function(){""===i(this).val()&&(i("#"+e.startDateId).val(""),i("#"+e.endDateId).val(""),i("#"+e.startCompareDateId).val(""),i("#"+e.endCompareDateId).val(""))})},s.prototype.bindChangeForSelect=function(){var t=this,e=function(t,e,a,s){function d(){i("#"+e).removeClass(s)}function r(){i("#"+e).addClass(s)}function n(){return i("#"+e).attr("class")==s}s=s||"open";var p=null,h=500;i("#"+t).click(function(){n()?d():r()}).mouseover(function(){clearTimeout(p)}).mouseout(function(){p=setTimeout(d,h)}),i("#"+a).mouseover(function(){clearTimeout(p)}).mouseout(function(){p=setTimeout(d,h)})};try{i("#"+this.dateListId).find('div[id*="selected"]').each(function(){var a=i(this).attr("id").match(/(\w+)_(\d)/i);if(a){var s=a[1],d=a[2];"yselected"==s?e("_ybtn_"+d,i(this).attr("id"),"_yctn_"+d):"mselected"==s&&e("_mbtn_"+d,i(this).attr("id"),"_mctn_"+d),i(this).find("li a").each(function(){i(this).click(function(){var e=i(this).parents(".select_wrap").attr("id").match(/(\w+)_(\d)/i),a=e[1],s=e[2],d=null;s^!1?("yselected"==a?t.calendar_startDate.setYear(1*i(this).text(),1):(a="mselected")&&t.calendar_startDate.setMonth(1*i(this).text()-1,1),t.mOpts.startDate=t.date2ymd(t.calendar_startDate).join("-"),d=t.fillDate(t.calendar_startDate.getFullYear(),t.calendar_startDate.getMonth(),s)):("yselected"==a?t.calendar_endDate.setYear(1*i(this).text(),1):(a="mselected")&&t.calendar_endDate.setMonth(1*i(this).text()-1,1),t.mOpts.endDate=t.date2ymd(t.calendar_endDate).join("-"),d=t.fillDate(t.calendar_endDate.getFullYear(),t.calendar_endDate.getMonth(),s));var r=i("#"+t.dateListId).find("table").get(1^s);i(r).replaceWith(d),t.removeCSS(0),t.bindChangeForSelect()})})}})}catch(a){window.console&&console.log(a)}},s.prototype.getSpecialPeriod=function(t){var e=this,a=new Date;1==e.mOpts.isTodayValid&&""!=e.mOpts.isTodayValid||2>t?"":a.setTime(a.getTime()-864e5);var s=a.getTime()-24*t*60*60*1e3<1e3*e.mOpts.minValidDate?1e3*e.mOpts.minValidDate:a.getTime()-24*t*60*60*1e3,i=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();a.setTime(s);var d=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();return t==e.periodObj.aYesterday&&(i=d),{today:i,otherday:d}},s.prototype.getCurrentDate=function(){return{startDate:i("#"+this.mOpts.startDateId).val(),endDate:i("#"+this.mOpts.endDateId).val(),needCompare:i("#"+this.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+this.mOpts.startCompareDateId).val(),endCompareDate:i("#"+this.mOpts.endCompareDateId).val()}},s.prototype.removeCSS=function(t,e){"undefined"==typeof e&&(e=this.mOpts.theme+"_"+this.mOpts.coincideCss),"undefined"==typeof t&&(t=0);var a=this.calendar_startDate,s=this.calendar_endDate;this.mOpts.magicSelect&&(a=this.str2date(i("#"+this.startDateId).val()),s=this.str2date(i("#"+this.endDateId).val()));for(var d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),r="",n=new Date(d);n.getTime()<=s.getTime();n.setDate(n.getDate()+1))r=0==t?this.mOpts.theme+"_"+this.mOpts.selectCss:this.mOpts.theme+"_"+this.mOpts.compareCss,i("#"+this.calendarId+"_"+this.date2ymd(n).join("-")).removeClass(r),i("#"+this.calendarId+"_"+this.date2ymd(n).join("-")).removeClass(this.mOpts.firstCss).removeClass(this.mOpts.lastCss).removeClass(this.mOpts.clickCss)},s.prototype.addCSS=function(t,e){"undefined"==typeof e&&(e=this.mOpts.theme+"_"+this.mOpts.coincideCss),"undefined"==typeof t&&(t=0);for(var a=this.str2date(i("#"+this.startDateId).val()),s=this.str2date(i("#"+this.endDateId).val()),d=this.str2date(i("#"+this.startCompareDateId).val()),r=this.str2date(i("#"+this.endCompareDateId).val()),n=0==t?a:d,p=0==t?s:r,h="",m=new Date(n);m.getTime()<=p.getTime();m.setDate(m.getDate()+1))0==t?(h=this.mOpts.theme+"_"+this.mOpts.selectCss,i("#"+this.calendarId+"_"+this.date2ymd(m).join("-")).removeClass(this.mOpts.firstCss).removeClass(this.mOpts.lastCss).removeClass(this.mOpts.clickCss),i("#"+this.calendarId+"_"+this.date2ymd(m).join("-")).removeClass(h)):h=this.mOpts.theme+"_"+this.mOpts.compareCss,i("#"+this.calendarId+"_"+this.date2ymd(m).join("-")).attr("class",h);"ta"==this.mOpts.theme&&(i("#"+this.calendarId+"_"+this.date2ymd(new Date(n)).join("-")).removeClass().addClass(this.mOpts.firstCss),i("#"+this.calendarId+"_"+this.date2ymd(new Date(p)).join("-")).removeClass().addClass(this.mOpts.lastCss),n.getTime()==p.getTime()&&i("#"+this.calendarId+"_"+this.date2ymd(new Date(p)).join("-")).removeClass().addClass(this.mOpts.clickCss))},s.prototype.checkDateRange=function(t,e){var a,s=this.str2date(t),i=this.str2date(e),d=s.getTime(),r=i.getTime();if(r>=d){if(a=this.str2date(t),a.setMonth(a.getMonth()+this.mOpts.monthRangeMax),a.setDate(a.getDate()+this.mOpts.dayRangeMax-1),a.getTime()<r)return alert("结束日期不能大于："+this.date2ymd(a).join("-")),!1}else if(a=this.str2date(e),a.setMonth(a.getMonth()-this.mOpts.monthRangeMax),a.setDate(a.getDate()-this.mOpts.dayRangeMax+1),a.getTime()>r)return alert("开始日期不能小于："+this.date2ymd(a).join("-")),!1;return!0},s.prototype.selectDate=function(t){this.changeInput(this.dateInput);var e=this.formatDate(t);if(this.startDateId==this.dateInput)this.removeCSS(0),this.removeCSS(1),i("#"+this.calendarId+"_"+t).attr("class","ta"==this.mOpts.theme?this.mOpts.clickCss:this.mOpts.theme+"_"+this.mOpts.selectCss),this.startDefDate=i("#"+this.dateInput).val(),i("#"+this.dateInput).val(e),1==this.mOpts.singleCompare||1==this.mOpts.isSingleDay?(this.dateInput=this.startDateId,i("#"+this.endDateId).val(e),(this.mOpts.shortOpr||this.mOpts.autoSubmit)&&this.close(1),this.mOpts.success({startDate:i("#"+this.mOpts.startDateId).val(),endDate:i("#"+this.mOpts.endDateId).val(),needCompare:i("#"+this.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+this.mOpts.startCompareDateId).val(),endCompareDate:i("#"+this.mOpts.endCompareDateId).val()})):this.dateInput=this.endDateId;else if(this.endDateId==this.dateInput){if(""==i("#"+this.startDateId).val())return this.dateInput=this.startDateId,this.selectDate(t),!1;if(0==this.checkDateRange(i("#"+this.startDateId).val(),t))return!1;-1==this.compareStrDate(t,i("#"+this.startDateId).val())&&(i("#"+this.dateInput).val(i("#"+this.startDateId).val()),i("#"+this.startDateId).val(e),e=i("#"+this.dateInput).val()),i("#"+this.dateInput).val(e),this.dateInput=this.startDateId,this.removeCSS(0),this.addCSS(0),this.startDefDate="",this.mOpts.autoSubmit&&(this.close(1),this.mOpts.success({startDate:i("#"+this.mOpts.startDateId).val(),endDate:i("#"+this.mOpts.endDateId).val(),needCompare:i("#"+this.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+this.mOpts.startCompareDateId).val(),endCompareDate:i("#"+this.mOpts.endCompareDateId).val()}))}else if(this.startCompareDateId==this.dateInput)this.removeCSS(1),this.removeCSS(0),i("#"+this.calendarId+"_"+t).attr("class","ta"==this.mOpts.theme?this.mOpts.clickCss:this.mOpts.theme+"_"+this.mOpts.compareCss),this.startDefDate=i("#"+this.dateInput).val(),i("#"+this.dateInput).val(e),1==this.mOpts.singleCompare||1==this.mOpts.isSingleDay?(this.dateInput=this.startCompareDateId,i("#"+this.endCompareDateId).val(e),(this.mOpts.shortOpr||this.mOpts.autoSubmit)&&this.close(1),this.mOpts.success({startDate:i("#"+this.mOpts.startDateId).val(),endDate:i("#"+this.mOpts.endDateId).val(),needCompare:i("#"+this.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+this.mOpts.startCompareDateId).val(),endCompareDate:i("#"+this.mOpts.endCompareDateId).val()})):this.dateInput=this.endCompareDateId;else if(this.endCompareDateId==this.dateInput){if(""==i("#"+this.startCompareDateId).val())return this.dateInput=this.startCompareDateId,this.selectDate(t),!1;if(0==this.checkDateRange(i("#"+this.startCompareDateId).val(),t))return!1;-1==this.compareStrDate(t,i("#"+this.startCompareDateId).val())&&(i("#"+this.dateInput).val(i("#"+this.startCompareDateId).val()),i("#"+this.startCompareDateId).val(e),e=i("#"+this.dateInput).val()),i("#"+this.dateInput).val(e),this.dateInput=this.startCompareDateId,this.removeCSS(1),this.addCSS(1),this.startDefDate="",this.mOpts.autoSubmit&&(this.close(1),this.mOpts.success({startDate:i("#"+this.mOpts.startDateId).val(),endDate:i("#"+this.mOpts.endDateId).val(),needCompare:i("#"+this.mOpts.compareCheckboxId).val(),startCompareDate:i("#"+this.mOpts.startCompareDateId).val(),endCompareDate:i("#"+this.mOpts.endCompareDateId).val()}))}},s.prototype.show=function(t,e){i("#"+e.dateRangeDiv).css("display",t?"none":""),i("#"+e.dateRangeCompareDiv).css("display",t?"":"none");var a=t?i("#"+this.inputCompareId).offset():i("#"+this.inputId).offset(),s=(t?i("#"+this.inputCompareId).height():i("#"+this.inputId).height(),parseInt(i(document.body)[0].clientWidth)),d=a.left;return i("#"+this.calendarId).css("display","block"),(1==this.mOpts.singleCompare||1==this.mOpts.isSingleDay)&&(i("#"+this.endDateId).css("display","none"),i("#"+this.endCompareDateId).css("display","none"),i("#"+this.mOpts.joinLineId).css("display","none"),i("."+this.mOpts.joinLineId).css("display","none")),s>0&&i("#"+this.calendarId).width()+a.left>s&&(d=a.left+i("#"+this.inputId).width()-i("#"+this.calendarId).width()+(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?5:0),"ta"==e.mOpts.theme&&(d+=50)),i("#"+this.calendarId).css("left",d+"px"),i("#"+this.calendarId).css("top",a.top+("ta"==e.mOpts.theme?35:22)+"px"),t?this.changeInput(this.startCompareDateId):this.changeInput(this.startDateId),!1},s.prototype.close=function(t){var e=this;if(t){this.mOpts.shortOpr===!0?(i("#"+this.inputId).val(i("#"+this.startDateId).val()),i("#"+this.inputCompareId).val(i("#"+this.startCompareDateId).val())):i("#"+this.inputId).val(i("#"+this.startDateId).val()+(""==i("#"+this.endDateId).val()?"":this.mOpts.defaultText+i("#"+this.endDateId).val()));var a=1==this.mOpts.isTodayValid&&""!=this.mOpts.isTodayValid?(new Date).getTime():(new Date).getTime()-864e5,s=this.str2date(i("#"+this.startDateId).val()).getTime(),d=this.str2date(i("#"+this.endDateId).val()).getTime();if(s>d){var r=i("#"+this.startDateId).val();i("#"+this.startDateId).val(i("#"+this.endDateId).val()),i("#"+this.endDateId).val(r)}var n=1==this.mOpts.shortOpr?i("#"+this.startDateId).val():i("#"+this.startDateId).val()+(""==i("#"+this.endDateId).val()?"":this.mOpts.defaultText+i("#"+this.endDateId).val()),p=document.getElementById(this.inputId);if(p&&"INPUT"==p.tagName?(i("#"+this.inputId).val(n),i("#"+this.inputCompareId).is(":visible")&&i("#"+this.inputCompareId).val(c)):(i("#"+this.inputId).html(n),i("#"+this.inputCompareId).is(":visible")&&i("#"+this.inputCompareId).html(c)),"ta"!=this.mOpts.theme&&""!=i("#"+this.startCompareDateId).val()&&""!=i("#"+this.endCompareDateId).val()){var h=this.str2date(i("#"+this.startCompareDateId).val()).getTime(),m=this.str2date(i("#"+this.endCompareDateId).val()).getTime(),o=h+d-s;o>a&&(o=a,i("#"+this.startCompareDateId).val(this.formatDate(this.date2ymd(new Date(o+s-d)).join("-")))),i("#"+this.endCompareDateId).val(this.formatDate(this.date2ymd(new Date(o)).join("-")));var h=this.str2date(i("#"+this.startCompareDateId).val()).getTime(),m=this.str2date(i("#"+this.endCompareDateId).val()).getTime();if(h>m){var r=i("#"+this.startCompareDateId).val();i("#"+this.startCompareDateId).val(i("#"+this.endCompareDateId).val()),i("#"+this.endCompareDateId).val(r)}}var c=1==this.mOpts.shortOpr?i("#"+this.startCompareDateId).val():i("#"+this.startCompareDateId).val()+(""==i("#"+this.endCompareDateId).val()?"":this.mOpts.defaultText+i("#"+this.endCompareDateId).val());p&&"INPUT"==p.tagName?i("#"+this.inputCompareId).val(c):i("#"+this.inputCompareId).html(c);i("#"+this.mOpts.startDateId).val(i("#"+this.startDateId).val()),i("#"+this.mOpts.endDateId).val(i("#"+this.endDateId).val()),i("#"+this.mOpts.startCompareDateId).val(i("#"+this.startCompareDateId).val()),i("#"+this.mOpts.endCompareDateId).val(i("#"+this.endCompareDateId).val());for(var l in this.periodObj)i("#"+this.mOpts[l])&&i("#"+this.mOpts[l]).parent().removeClass("a")}return i("#"+e.calendarId).css("display","none"),!1},s.prototype.fillDate=function(t,e,a){var s=this,d="ta"==this.mOpts.theme,r=new Date(t,e,1),n=new Date(t,e,1),p=n.getDay();n.setDate(1-p);var h=new Date(t,e+1,0),m=new Date(t,e+1,0);p=m.getDay(),m.setDate(m.getDate()+6-p);var o=new Date,c=o.getDate(),l=o.getMonth(),D=o.getFullYear(),I=document.createElement("table");if(d){if(I.className=this.mOpts.dateTable,cap=document.createElement("caption"),this.mOpts.magicSelect){var v=['<div class="select_wrap" id="yselected_'+a+'"><div class="select" id="_ybtn_'+a+'">'+t+'</div><div class="dropdown" id="_yctn_'+a+'"><ul class="list_menu">'],C=['<div class="select_wrap" id="mselected_'+a+'"><div class="select" id="_mbtn_'+a+'">'+(e+1)+'</div><div class="dropdown" id="_mctn_'+a+'"><ul class="list_menu">'];O=1,yt=D;do v.push('<li><a href="javascript:;">'+yt--+"</a></li>"),C.push('<li><a href="javascript:;">'+O++ +"</a></li>");while(12>=O);v.push("</ul></div></div>"),C.push("</ul></div></div>"),i(cap).append(v.join("")+'<span class="joinLine"> 年 </span>'+C.join("")+'<span class="joinLine"> 月 </span>')}else i(cap).append(t+"年"+(e+1)+"月");i(I).append(cap),thead=document.createElement("thead"),tr=document.createElement("tr");for(var u=["日","一","二","三","四","五","六"],O=0;7>O;O++)th=document.createElement("th"),i(th).append(u[O]),i(tr).append(th);i(thead).append(tr),i(I).append(thead),tr=document.createElement("tr"),td=document.createElement("td"),this.mOpts.magicSelect||(0==a&&i(td).append('<a href="javascript:void(0);" id="'+this.nextMonth+'"><i class="i_next"></i></a>'),a+1==this.mOpts.calendars&&i(td).append('<a href="javascript:void(0);" id="'+this.preMonth+'"><i class="i_pre"></i></a>')),i(td).attr("colSpan",7),i(td).css("text-align","center"),i(tr).append(td),i(I).append(tr)}else{I.className=this.mOpts.theme+"_"+this.mOpts.dateTable,tr=document.createElement("tr"),td=document.createElement("td"),0==a&&i(td).append('<a href="javascript:void(0);" id="'+this.nextMonth+'" class="gri_dateRangeNextMonth"><span>next</span></a>'),a+1==this.mOpts.calendars&&i(td).append('<a href="javascript:void(0);" id="'+this.preMonth+'" class="gri_dateRangePreMonth"><span>pre</span></a>'),i(td).append(t+"年"+(e+1)+"月"),i(td).attr("colSpan",7),i(td).css("text-align","center"),i(td).css("background-color","#F9F9F9"),i(tr).append(td),i(I).append(tr);var u=["日","一","二","三","四","五","六"];tr=document.createElement("tr");for(var O=0;7>O;O++)td=document.createElement("td"),i(td).append(u[O]),i(tr).append(td);i(I).append(tr)}for(var g="",y=0,f="",b=n;b.getTime()<=m.getTime();b.setDate(b.getDate()+1)){if(b.getTime()<r.getTime())g=this.mOpts.theme+"_"+this.mOpts.disableGray,y="-1";else if(b.getTime()>h.getTime())g=this.mOpts.theme+"_"+this.mOpts.disableGray,y="1";else if(1==this.mOpts.stopToday&&b.getTime()>o.getTime()||b.getTime()<1e3*s.mOpts.minValidDate||""!==s.mOpts.maxValidDate&&b.getTime()>1e3*s.mOpts.maxValidDate)g=this.mOpts.theme+"_"+this.mOpts.disableGray,
y="2";else{if(y="0",b.getDate()==c&&b.getMonth()==l&&b.getFullYear()==D?1==this.mOpts.isTodayValid?g=this.mOpts.theme+"_"+this.mOpts.isToday:(g=this.mOpts.theme+"_"+this.mOpts.disableGray,y="2"):g="",!this.mOpts.weekendDis||6!=b.getDay()&&0!=b.getDay()||(g=this.mOpts.theme+"_"+this.mOpts.disableGray,y="3"),this.mOpts.disCertainDay&&this.mOpts.disCertainDay.length>0)for(var _ in this.mOpts.disCertainDay)isNaN(this.mOpts.disCertainDay[_])||b.getDay()!==this.mOpts.disCertainDay[_]||(g=this.mOpts.theme+"_"+this.mOpts.disableGray,y="4");if(this.mOpts.disCertainDate&&this.mOpts.disCertainDate.length>0){var k=!1;for(var _ in this.mOpts.disCertainDate)if(!isNaN(this.mOpts.disCertainDate[_])||isNaN(parseInt(this.mOpts.disCertainDate[_])))if(this.mOpts.disCertainDate[0]===!0){if(k=!(b.getDate()===this.mOpts.disCertainDate[_]),!k)break}else if(k=!(b.getDate()!==this.mOpts.disCertainDate[_]))break;k&&(g=this.mOpts.theme+"_"+this.mOpts.disableGray,y="4")}}0==b.getDay()&&(tr=document.createElement("tr")),td=document.createElement("td"),td.innerHTML=b.getDate(),""!=g&&i(td).attr("class",g),0==y&&(f=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate(),i(td).attr("id",s.calendarId+"_"+f),i(td).css("cursor","pointer"),function(t){i(td).bind("click",t,function(){return s.selectDate(t),!1})}(f)),i(tr).append(td),6==b.getDay()&&i(I).append(tr)}return I},s.prototype.str2date=function(t){var e=t.split("-");return new Date(e[0],e[1]-1,e[2])},s.prototype.compareStrDate=function(t,e){var a=this.str2date(t),s=this.str2date(e);return a.getTime()>s.getTime()?1:a.getTime()==s.getTime()?0:-1},s.prototype.date2ymd=function(t){return[t.getFullYear(),t.getMonth()+1,t.getDate()]},s.prototype.changeInput=function(t){1==this.mOpts.isSingleDay&&(t=this.startDateId);var e=[this.startDateId,this.startCompareDateId,this.endDateId,this.endCompareDateId],a="";a=t==this.startDateId||t==this.endDateId?this.mOpts.theme+"_"+this.mOpts.selectCss:this.mOpts.theme+"_"+this.mOpts.compareCss,t==this.endDateId&&this.mOpts.singleCompare&&(a=this.mOpts.theme+"_"+this.mOpts.compareCss);for(var s in e)i("#"+e[s]).removeClass(this.mOpts.theme+"_"+this.mOpts.selectCss),i("#"+e[s]).removeClass(this.mOpts.theme+"_"+this.mOpts.compareCss);i("#"+t).addClass(a),i("#"+t).css("background-repeat","repeat"),this.dateInput=t},s.prototype.formatDate=function(t){return t.replace(/(\d{4})\-(\d{1,2})\-(\d{1,2})/g,function(t,e,a,s){return 10>a&&(a="0"+a),10>s&&(s="0"+s),e+"-"+a+"-"+s})},e.pickerDateRange=s});